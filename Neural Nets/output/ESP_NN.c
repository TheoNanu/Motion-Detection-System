#include <stdio.h>
#include <stdlib.h>
#include <math.h>

#define INPUT_SIZE 8
#define OUTPUT_SIZE 1

#define ADD(a, b) (a + b)
#define SUBTRACT(a, b) (a - b)
#define MULTIPLY(a, b) (a * b)
#define DIVIDE(a, b) (a / b)
#define sigmoid(x) 1 / (1 + exp(-x))
#define tanh(x) 2 / (1 + exp(-2 * x)) - 1
#define relu(x) x > 0 ? x : 0
#define selu(x) x > 0 ? 1.05070098 * x : 1.05070098 * 1.67326324 * (exp(x) - 1)
#define softplus(x) log(exp(x) + 1)
#define softsign(x) x / (abs(x) + 1)
#define exponential(x) exp(x)
#define elu(x) x > 0 ? x : 1.67326324 * (exp(x) - 1)

float *softmax(float vector[], int len)
{
	float* result = (float*) malloc(len * sizeof(float));

	if(!result)
		return NULL;

	for(int i = 0; i < len; i++)
	{
		float sum = 0;
		for(int j = 0; j < len; j++)
		{
			sum += exp(vector[j]);
		}
		result[i] = exp(vector[i]) / sum;
	}
	return result;
}

static const float bias_0[8] = {-0.0967458, -0.07755844, -0.05002019, -0.20432487, 0.0924621, 0.021204302, -0.07127586, 0.062366076};

static const float weights_0[8][8] = {
		{-0.6528268, -0.09958439, 0.100791916, 0.09414966, 1.0387533, -0.2620532, -0.23593038, 0.3617426},
		{0.232355, 0.3826704, 0.26470602, -0.42824748, -0.23111892, -0.5472678, 0.32428128, 0.3962214},
		{0.30893233, 0.3316482, -0.3677965, 0.050017726, -1.2240518, 0.2375331, 0.28930017, 0.37205845},
		{-0.48135865, 0.036462292, 0.34959638, 0.18009515, 0.99945295, 0.39743182, -0.20978568, -0.18370385},
		{0.37849408, 0.054904353, -0.52168226, 0.32036078, -1.0664464, 0.2586896, 0.3264828, -0.10375011},
		{-0.37764522, 0.42132726, -0.016195131, -0.6160409, -0.38171542, -0.041639946, 0.3754269, 0.031250678},
		{-0.34690565, -1.016324, 0.008621894, 0.649932, 0.39487278, -0.25239596, 0.09261102, 0.19986193},
		{0.4132641, 1.0313958, 0.3886991, -0.8099621, -1.4810429, -0.39331117, -0.346154, 0.061457723}
};

static const float bias_1[12] = {0.11293982, -0.0022863536, -0.07220204, 0.061260447, -0.003831924, -0.19157201, -0.048604768, 0.037629813, 0.09481978, -0.024313528, -0.04749134, -0.015455814};

static const float weights_1[12][8] = {
		{-0.3701106, 0.22349197, -0.081700064, -0.22617647, 0.33600372, 0.100850254, -0.24818182, 0.81171113},
		{-0.4306662, -0.30482686, 0.5137295, -0.67064273, -0.38031164, 0.26151952, -0.27613938, 0.4774548},
		{-0.09867002, 0.334412, -0.55557454, 0.6192489, -0.24941355, -0.29962558, 0.83211035, -0.59473836},
		{0.05287663, -0.12702425, -0.31832224, -0.30663761, -0.5496689, -0.18161952, 0.37992364, -0.75010735},
		{0.040126566, 0.169391, -0.27519187, 0.04520477, 0.020696852, -0.35397092, 0.31298834, -0.43067846},
		{-0.029348837, 0.3651082, 0.35591993, 0.1948096, 0.4003707, -0.11147594, -0.82000285, 0.38483486},
		{-0.09629965, 0.101276435, 0.31695485, -0.57513463, 0.33761382, -0.40901402, -0.68389124, 0.23959658},
		{-0.6151796, 0.5628454, -0.36138132, -0.1790707, 0.10433557, -0.33679792, 0.08073787, 0.5118801},
		{-0.2388771, -0.118493, -0.014988185, -0.41419083, 0.09710945, -0.189728, 0.31153604, 0.24536552},
		{0.30525085, -0.04772046, -0.35259238, 0.56759614, -0.3089981, 0.06234277, 0.5799517, -0.7401335},
		{0.13163617, 0.18326479, -0.2759176, 0.5418721, -0.3391492, 0.19923672, 0.19858979, -0.4559118},
		{0.1666524, -0.2585776, 0.015427052, 0.16650808, 0.15766442, -0.24991633, 0.48078468, -0.35001138}
};

static const float bias_2[12] = {-0.014394059, -0.0015053074, -0.031618502, -0.015778719, 0.042392865, -0.028152581, -0.014145004, -0.021101275, -0.003377149, -5.7276135e-05, -0.018907696, 0.034310155};

static const float weights_2[12][12] = {
		{-0.10714287, -0.19723602, 0.50416934, 0.42853802, 0.25008652, 0.0087948665, -0.57719195, -0.55698407, -0.39560345, 0.1465597, 0.3744396, -0.025575502},
		{-0.1434172, 0.2869846, -0.41468453, -0.22128122, -0.17402141, -0.007917133, -0.13975623, 0.21618249, 0.5537736, -0.63869566, -0.45446783, -0.5906931},
		{0.14021137, 0.1553416, -0.10290054, -0.37547776, -0.109474815, 0.43311948, 0.052752245, 0.51501584, 0.38069922, -0.10886309, -0.5590157, -0.42942095},
		{0.23107745, 0.5378652, 0.07241447, -0.5030516, -0.4664175, 0.23813719, 0.5121503, 0.6358638, -0.2964058, -0.3005116, -0.2832911, -0.5269424},
		{0.3541033, 0.49216774, -0.7321749, -0.2625379, -0.5543873, -0.19577664, 0.6499688, -0.23171052, -0.23426865, -0.20251249, -0.52352226, 0.09092716},
		{-0.10172589, 0.15503766, -0.17298971, -0.008992208, 0.19625658, 0.1973758, 0.1749174, 0.3725899, -0.17531338, -0.047254276, 0.00978085, -0.09183812},
		{-0.03220552, -0.77955896, 0.53679657, 0.49222428, 0.28690994, -0.11338679, -0.4962509, -0.16470046, 0.037787713, 0.53162616, 0.5802379, 0.2614135},
		{-0.12856288, -0.58035004, 0.26665896, 0.4259287, 0.41263598, -0.16467005, -0.6046896, 0.020624382, -0.310309, 0.51897573, 0.5253963, 0.67282575},
		{0.11928722, 0.27463228, 0.0055571515, 0.1346013, -0.49436015, 0.5348431, 0.5022345, -0.25610167, -0.2296869, -0.49713024, -0.4458611, 0.0010271512},
		{0.20667122, 0.28268638, -0.65889794, -0.36392903, -0.060236946, 0.4198694, -0.026118468, -0.14260776, 0.4642967, -0.88903344, -0.1606574, -0.26175746},
		{-0.18961054, -0.8491956, 0.28965196, 0.13512696, 0.09784635, -0.020711072, -0.036944687, -0.59947866, -0.0020241132, 0.30966917, 0.45121142, 0.5180856},
		{-0.018924262, 0.08202746, 0.1717731, 0.07631343, 0.11394604, -0.34317297, -0.37011638, 0.27458417, -0.24158111, 0.09078275, -0.06327857, -0.23191348}
};

static const float bias_3[6] = {0.013789321, -0.018142918, -0.030036885, -0.036607984, -0.03949464, -0.08610946};

static const float weights_3[6][12] = {
		{0.48031443, 0.029588468, -0.58213437, -0.011562999, 0.005249472, -0.14585821, 0.5367793, 0.7301902, 0.016125532, -0.6107322, 0.7046147, 0.3273086},
		{0.009198278, -0.34508285, -0.051339246, -0.36006314, -0.20133394, -0.073706314, 0.2259057, 0.45405945, -0.3452738, -0.3631299, 0.5191881, -0.090780325},
		{0.49609733, -0.52795106, -0.44683382, -0.5429631, -0.6278028, 0.30531338, 0.65206856, 0.42714876, -0.3109602, -0.066264965, 0.117493, 0.10117132},
		{0.45440432, -0.5918249, 0.055831958, -0.39941442, -0.43124744, 0.023011835, 0.34183446, 0.26813814, -0.15481797, -0.6087997, 0.12071732, 0.513645},
		{0.5031152, -0.5030221, -0.694472, -0.2938907, -0.773561, -0.49249807, 0.35486108, 0.19153777, -0.30231762, -0.44023427, 0.35441175, -0.30221137},
		{-0.38888362, -0.16963623, 0.39257473, 0.5891783, 0.14087428, 0.3152585, -0.29476443, -0.16041426, 0.14752768, 0.23848099, -0.6702745, 0.3852628}
};

static const float bias_4[1] = {0.10293538};

static const float weights_4[1][6] = {
		{-0.44251293, -0.61800784, -0.46926758, -0.530052, -0.44110444, 0.3861746}
};

void ESP_NN(const float input[INPUT_SIZE], float output[OUTPUT_SIZE])
{
	float output_0[8];

	for(int i = 0; i < 8; i++)
	{
		float res = 0;
		for(int j = 0; j < 8; j++)
		{
			res += input[j] * weights_0[i][j];
		}
		output_0[i] = selu(res + bias_0[i]);
	}

	float output_1[12];

	for(int i = 0; i < 12; i++)
	{
		float res = 0;
		for(int j = 0; j < 8; j++)
		{
			res += output_0[j] * weights_1[i][j];
		}
		output_1[i] = selu(res + bias_1[i]);
	}

	float output_2[12];

	for(int i = 0; i < 12; i++)
	{
		float res = 0;
		for(int j = 0; j < 12; j++)
		{
			res += output_1[j] * weights_2[i][j];
		}
		output_2[i] = selu(res + bias_2[i]);
	}

	float output_3[6];

	for(int i = 0; i < 6; i++)
	{
		float res = 0;
		for(int j = 0; j < 12; j++)
		{
			res += output_2[j] * weights_3[i][j];
		}
		output_3[i] = selu(res + bias_3[i]);
	}

	float output_4[1];

	for(int i = 0; i < 1; i++)
	{
		float res = 0;
		for(int j = 0; j < 6; j++)
		{
			res += output_3[j] * weights_4[i][j];
		}
		output_4[i] = sigmoid(res + bias_4[i]);
	}
	output[0] = output_4[0];
}